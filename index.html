<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> PCE F Division</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .glass-card { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.4); }
        .progress-ring { transition: stroke-dashoffset 0.35s; transform: rotate(-90deg); transform-origin: 50% 50%; }
        .animate-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- Student Database ---
        const STUDENT_DB = {
            "601": "Neha Sali",
            "602": "Soumadip Samanta",
            "603": "Sandesh Shinde",
            "642": "Niranjan Tupe",
            
        };

        const ProgressCircle = ({ percentage, size = 60, stroke = 5 }) => {
            const radius = (size / 2) - stroke;
            const circumference = radius * 2 * Math.PI;
            const offset = circumference - (percentage / 100) * circumference;
            const color = percentage >= 75 ? '#10b981' : percentage >= 60 ? '#f59e0b' : '#ef4444';

            return (
                <div className="relative flex items-center justify-center" style={{ width: size, height: size }}>
                    <svg width={size} height={size}>
                        <circle stroke="#e5e7eb" strokeWidth={stroke} fill="transparent" r={radius} cx={size/2} cy={size/2} />
                        <circle 
                            className="progress-ring" 
                            stroke={color} 
                            strokeWidth={stroke} 
                            strokeDasharray={`${circumference} ${circumference}`} 
                            style={{ strokeDashoffset: offset }} 
                            strokeLinecap="round" 
                            fill="transparent" 
                            r={radius} 
                            cx={size/2} 
                            cy={size/2} 
                        />
                    </svg>
                    <span className="absolute text-[10px] font-bold text-slate-700">{Math.round(percentage)}%</span>
                </div>
            );
        };

        function App() {
            const [rollInput, setRollInput] = useState("");
            const [user, setUser] = useState(null);
            const [subjects, setSubjects] = useState([]);
            const [showModal, setShowModal] = useState(false);
            const [newSub, setNewSub] = useState("");

            // Device ownership & offline mode
            const [ownerRoll, setOwnerRoll] = useState(localStorage.getItem('device_owner') || null);
            const [infoMessage, setInfoMessage] = useState('');
            const isOwner = user && ownerRoll === user?.roll;
            const readOnly = user && !isOwner; 

            // Login Logic
            useEffect(() => {
                if (STUDENT_DB[rollInput]) {
                    const name = STUDENT_DB[rollInput];
                    setUser({ roll: rollInput, name });
                    // Load user-specific data
                    const saved = localStorage.getItem(`attendance_${rollInput}`);
                    setSubjects(saved ? JSON.parse(saved) : [
                        { id: 1, name: "Mathematics", present: 0, total: 0 },
                        { id: 2, name: "Java", present: 0, total: 0 },
                        { id: 3, name: "Physics", present: 0, total: 0 },
                        { id: 4, name: "PCE", present: 0, total: 0 },
                        { id: 5, name: "mechanics", present: 0, total: 0 },
                        { id: 6, name: "Workshop", present: 0, total: 0 },
                        { id: 7, name: "Maths tutorial", present: 0, total: 0 },
                        { id: 8, name: "Java practical", present: 0, total: 0 },
                        { id: 9, name: "Physics practical", present: 0, total: 0 },
                        { id: 10, name: "PCE tutorial", present: 0, total: 0 },
                        { id: 11, name: "mechanics tutorial", present: 0, total: 0 }, 
                    
                    ]);
                }
            }, [rollInput]);

            // Device owner detection
            useEffect(() => {
                if (!user) return;
                const existingOwner = localStorage.getItem('device_owner');
                if (!existingOwner) {
                    localStorage.setItem('device_owner', user.roll);
                    setOwnerRoll(user.roll);
                    setInfoMessage('Device claimed by this roll. Only this roll can make edits.');
                    setTimeout(() => setInfoMessage(''), 3500);
                } else {
                    setOwnerRoll(existingOwner);
                    if (existingOwner !== user.roll) {
                        setInfoMessage("Offline Mode: Login is used only to fetch your Batch/Name. Your attendance is stored locally on this device. You cannot edit others' data.");
                    } else {
                        setInfoMessage('');
                    }
                }
            }, [user]);

            // Save Logic
            useEffect(() => {
                if (user) {
                    localStorage.setItem(`attendance_${user.roll}`, JSON.stringify(subjects));
                }
            }, [subjects, user]);

            const updateCount = (id, type) => {
                if (readOnly) {
                    setInfoMessage(`This device is claimed by ${ownerRoll}. You cannot edit others' data.`);
                    setTimeout(() => setInfoMessage(''), 3000);
                    return;
                }

                setSubjects(prev => prev.map(s => {
                    if (s.id !== id) return s;
                    if (type === 'p') return { ...s, present: s.present + 1, total: s.total + 1 };
                    if (type === 'a') return { ...s, total: s.total + 1 };
                    if (type === 'undo') return { ...s, present: Math.max(0, s.present - 1), total: Math.max(0, s.total - 1) };
                    return s;
                }));
            };

            const addSubject = () => {
                if (readOnly) {
                    setInfoMessage(`This device is claimed by ${ownerRoll}. You cannot edit others' data.`);
                    setTimeout(() => setInfoMessage(''), 3000);
                    setShowModal(false);
                    return;
                }

                if (!newSub.trim()) return;
                setSubjects([...subjects, { id: Date.now(), name: newSub, present: 0, total: 0 }]);
                setNewSub("");
                setShowModal(false);
            };

            const calculatePrediction = (p, t) => {
                const target = 75;
                if (t === 0) return "No classes yet";
                const current = (p / t) * 100;
                if (current >= target) {
                    const canMiss = Math.floor((100 * p - target * t) / target);
                    return canMiss > 0 ? `You can miss ${canMiss} more classes` : "On the boundary!";
                } else {
                    const mustAttend = Math.ceil((target * t - 100 * p) / (100 - target));
                    return `Attend next ${mustAttend} classes to reach ${target}%`;
                }
            };

            const stats = useMemo(() => {
                const totalP = subjects.reduce((a, b) => a + b.present, 0);
                const totalT = subjects.reduce((a, b) => a + b.total, 0);
                return { p: totalP, t: totalT, avg: totalT > 0 ? (totalP / totalT) * 100 : 0 };
            }, [subjects]);

            if (!user) {
                return (
                    <div className="min-h-screen flex flex-col items-center justify-center p-6 bg-slate-900 gap-8">
                        <div className="w-full max-w-sm glass-card rounded-3xl p-8 shadow-2xl animate-in text-center">
                            <div className="w-20 h-20 bg-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-xl shadow-blue-500/20">
                                <i className="fas fa-university text-white text-3xl"></i>
                            </div>
                            <h1 className="text-2xl font-extrabold text-slate-800 mb-2">PCE Attendance tracker</h1>
                            <p className="text-slate-500 text-sm mb-8">Enter your Roll Number to continue</p>
                            <input 
                                type="text" 
                                placeholder="e.g. 601" 
                                className="w-full bg-slate-100 border-none rounded-xl py-4 px-6 text-center text-xl font-bold text-slate-700 focus:ring-2 focus:ring-blue-500 transition-all outline-none"
                                value={rollInput}
                                onChange={(e) => setRollInput(e.target.value)}
                            />
                            <p className="mt-4 text-xs text-slate-400">Try 601,602, or 603</p>
                        </div>
                        <div className="text-center text-slate-300 text-sm font-medium">
                            Developed by Soumadip
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen pb-20 max-w-xl mx-auto px-4 pt-8">
                    {/* Header */}
                    <header className="flex justify-between items-center mb-8 animate-in">
                        <div>
                            <h2 className="text-2xl font-black text-slate-800 tracking-tight">Welcome, {user.name.split(' ')[0]}</h2>
                            <p className="text-sm font-bold text-blue-600">Roll: {user.roll}</p>
                        </div>

                        <div className="flex items-center gap-3">
                            {infoMessage && (
                                <div className="bg-slate-800 text-white text-sm px-4 py-2 rounded-md">{infoMessage}</div>
                            )}

                            <button onClick={() => {
                                if (readOnly) {
                                    setInfoMessage(`This device is claimed by ${ownerRoll}. You cannot edit others' data.`);
                                    setTimeout(() => setInfoMessage(''), 3000);
                                    return;
                                }
                                setShowModal(true);
                            }} className="text-slate-400 hover:text-slate-600 transition-colors bg-white p-2 rounded-lg shadow-sm border">
                                <i className="fas fa-plus text-sm text-slate-700"></i>
                            </button>

                            {isOwner && (
                                <button onClick={() => {
                                    localStorage.removeItem('device_owner');
                                    setOwnerRoll(null);
                                    setInfoMessage('Device released â€” another user can claim this device.');
                                    setTimeout(() => setInfoMessage(''), 3500);
                                }} className="bg-white p-2 rounded-lg shadow-sm border">
                                    <i className="fas fa-user-shield text-sm text-slate-700"></i>
                                </button>
                            )}

                            <button onClick={() => setUser(null)} className="text-slate-400 hover:text-rose-500 transition-colors">
                                <i className="fas fa-sign-out-alt text-xl"></i>
                            </button>
                        </div>
                    </header>

                    {/* Overall Summary */}
                    <div className="bg-blue-600 rounded-[2.5rem] p-8 text-white shadow-xl shadow-blue-100 mb-8 animate-in relative overflow-hidden">
                        <div className="relative z-10">
                            <p className="text-blue-100 text-xs font-bold uppercase tracking-widest mb-1 opacity-80">Aggregate Attendance</p>
                            <div className="flex items-baseline gap-2">
                                <h3 className="text-5xl font-black">{Math.round(stats.avg)}%</h3>
                                <span className="text-sm font-medium opacity-60">Goal: 75%</span>
                            </div>
                            <div className="mt-6 flex gap-6">
                                <div><p className="text-[10px] uppercase font-bold opacity-60">Present</p><p className="text-xl font-bold">{stats.p}</p></div>
                                <div className="w-px h-8 bg-white/20"></div>
                                <div><p className="text-[10px] uppercase font-bold opacity-60">Total</p><p className="text-xl font-bold">{stats.t}</p></div>
                            </div>
                        </div>
                        <div className="absolute -right-10 -bottom-10 w-40 h-40 bg-white/10 rounded-full blur-3xl"></div>
                    </div>

                    {/* Subjects List */}
                    <div className="space-y-4 animate-in">
                        <div className="flex justify-between items-center px-2">
                            <h4 className="font-extrabold text-slate-800 text-sm uppercase tracking-wider">Your Classes</h4>
                            <button onClick={() => {
                                if (readOnly) {
                                    setInfoMessage(`This device is claimed by ${ownerRoll}. You cannot edit others' data.`);
                                    setTimeout(() => setInfoMessage(''), 3000);
                                    return;
                                }
                                setShowModal(true);
                            }} className="w-8 h-8 bg-white rounded-full flex items-center justify-center text-blue-600 shadow-sm border border-slate-100">
                                <i className="fas fa-plus text-xs"></i>
                            </button>
                        </div>

                        {subjects.map(sub => (
                            <div key={sub.id} className="bg-white rounded-3xl p-5 shadow-sm border border-slate-100 flex flex-col gap-4">
                                <div className="flex justify-between items-start">
                                    <div className="flex gap-4">
                                        <ProgressCircle percentage={sub.total === 0 ? 0 : (sub.present / sub.total) * 100} />
                                        <div>
                                            <h5 className="font-bold text-slate-800 leading-tight">{sub.name}</h5>
                                            <p className="text-xs text-slate-400 font-medium">{sub.present} / {sub.total} Classes</p>
                                        </div>
                                    </div>
                                    <p className={`text-[10px] font-bold px-3 py-1 rounded-full ${sub.total > 0 && (sub.present/sub.total*100) >= 75 ? 'bg-green-50 text-green-600' : 'bg-amber-50 text-amber-600'}`}>
                                        {calculatePrediction(sub.present, sub.total)}
                                    </p>
                                </div>
                                <div className="grid grid-cols-3 gap-3">
                                    <button onClick={() => updateCount(sub.id, 'p')} className="bg-emerald-50 text-emerald-600 py-3 rounded-2xl flex flex-col items-center gap-1 active:scale-95 transition-all">
                                        <i className="fas fa-check-circle text-lg"></i>
                                        <span className="text-[10px] font-black uppercase">Present</span>
                                    </button>
                                    <button onClick={() => updateCount(sub.id, 'a')} className="bg-rose-50 text-rose-600 py-3 rounded-2xl flex flex-col items-center gap-1 active:scale-95 transition-all">
                                        <i className="fas fa-times-circle text-lg"></i>
                                        <span className="text-[10px] font-black uppercase">Absent</span>
                                    </button>
                                    <button onClick={() => updateCount(sub.id, 'undo')} className="bg-slate-50 text-slate-400 py-3 rounded-2xl flex flex-col items-center gap-1 active:scale-95 transition-all">
                                        <i className="fas fa-undo text-lg"></i>
                                        <span className="text-[10px] font-black uppercase">Undo</span>
                                    </button>
                                </div>
                            </div>
                        ))}
                    </div>

                    {/* Modal */}
                    {showModal && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-6 bg-slate-900/60 backdrop-blur-sm">
                            <div className="bg-white w-full max-w-sm rounded-[2rem] p-8 shadow-2xl animate-in">
                                <h3 className="text-xl font-bold text-slate-800 mb-6 uppercase tracking-tight">New Subject</h3>
                                <input 
                                    className="w-full bg-slate-100 border-none rounded-2xl py-5 px-6 font-bold text-slate-700 outline-none mb-6"
                                    placeholder="e.g. Operating Systems"
                                    value={newSub}
                                    onChange={(e) => setNewSub(e.target.value)}
                                />
                                <div className="flex gap-3">
                                    <button onClick={() => setShowModal(false)} className="flex-1 py-4 text-slate-400 font-bold">Cancel</button>
                                    <button onClick={addSubject} className="flex-1 bg-blue-600 text-white py-4 rounded-2xl font-bold shadow-lg shadow-blue-100">Add</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Footer */}
                    <div className="mt-8 text-center text-slate-400 text-sm font-medium">
                        Developed by Soumadip
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>